(()=>{"use strict";var e,o={727:(e,o,n)=>{const r=window.wp.blocks,t=window.wp.i18n,l=window.wp.blockEditor,a=window.wp.components,i=window.wp.element,s=window.wp.apiFetch;var c=n.n(s);const d=window.wp.data,m=window.ReactJSXRuntime,p="#2196f3",h={color:"#fff",borderRadius:"3px",padding:"8px 16px",display:"inline-flex",alignItems:"center",justifyContent:"center",textDecoration:"none",fontSize:"15px",fontWeight:"600",whiteSpace:"nowrap",minWidth:"85px",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},u={padding:"32px",textAlign:"center",borderRadius:"4px"};function g({buttons:e,onChange:o,label:n}){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("p",{style:{fontSize:"13px",color:"#757575",marginTop:0},children:n}),e.map(((n,r)=>(0,m.jsxs)(a.Card,{style:{marginBottom:"16px",border:"1px solid #ddd"},children:[(0,m.jsx)(a.CardHeader,{children:(0,m.jsxs)(a.Flex,{justify:"space-between",align:"center",children:[(0,m.jsxs)("span",{style:{fontWeight:600},children:["ボタン ",r+1]}),(0,m.jsx)(a.Button,{isDestructive:!0,isSmall:!0,onClick:()=>{const n=[...e];n.splice(r,1),o(n)},icon:"trash"})]})}),(0,m.jsxs)(a.CardBody,{children:[(0,m.jsx)(a.TextControl,{label:"ボタンテキスト",value:n.text||"",onChange:n=>{const t=[...e];t[r]={...t[r],text:n},o(t)},placeholder:"例: 公式サイト"}),(0,m.jsx)(a.TextControl,{label:"リンクURL",value:n.url||"",onChange:n=>{const t=[...e];t[r]={...t[r],url:n},o(t)},placeholder:"https://example.com"}),(0,m.jsx)(a.ToggleControl,{label:"別タブで開く",checked:!1!==n.openInNewTab,onChange:n=>{const t=[...e];t[r]={...t[r],openInNewTab:n},o(t)}}),(0,m.jsxs)("div",{style:{marginTop:"12px"},children:[(0,m.jsxs)(a.Button,{variant:"secondary",onClick:()=>{const n=[...e];n[r]={...n[r],showColorPicker:!n[r].showColorPicker},o(n)},style:{width:"100%",marginBottom:"8px"},children:[n.showColorPicker?"色を選択中":"ボタンの色を選択",(0,m.jsx)("span",{style:{marginLeft:"auto",width:"20px",height:"20px",backgroundColor:n.color||p,display:"inline-block",borderRadius:"3px",border:"1px solid #ddd",verticalAlign:"middle"}})]}),n.showColorPicker&&(0,m.jsx)(a.ColorPicker,{color:n.color||p,onChange:n=>{const t=[...e];t[r]={...t[r],color:n},o(t)},enableAlpha:!0,defaultValue:p})]})]})]},r))),(0,m.jsx)(a.Button,{variant:"secondary",onClick:()=>{const n=[...e,{text:"",url:"",openInNewTab:!0,color:p}];o(n)},icon:"plus",style:{width:"100%",justifyContent:"center"},children:"ボタンを追加"})]})}const k={backgroundColor:"#ff9900",text:"Amazon"},x={backgroundColor:"#bf0000",text:"楽天市場"},w={backgroundColor:"#ff0033",text:"Yahoo!ショッピング"},f={backgroundColor:"#4dc9ff",text:"メルカリ"},j={backgroundColor:"#00bcd4",text:"DMM"};function b(e,o,n){return e.text&&e.url?(0,m.jsx)("div",{className:"plm-shop-custom",children:(0,m.jsx)("a",{rel:"nofollow noopener",href:e.url,target:!1!==e.openInNewTab?"_blank":"_self",style:{...h,backgroundColor:e.color||p},children:e.text})},`${o}-${n}`):null}function C(e,o,n){return(0,m.jsx)("div",{className:`plm-shop-${e}`,children:(0,m.jsx)("a",{rel:"nofollow noopener",href:o,target:"_blank",style:{...h,backgroundColor:n.backgroundColor},children:n.text})},e)}function y({type:e,message:o}){const n={loading:{...u,color:"#888",backgroundColor:"#f5f5f5",border:"1px dashed #ccc",display:"flex",alignItems:"center",gap:"8px"},error:{...u,color:"#d63638",backgroundColor:"#fff0f0",border:"1px solid #d63638"},empty:{...u,color:"#666",backgroundColor:"#f5f5f5",border:"1px dashed #ccc"}};return(0,m.jsxs)("div",{style:n[e],children:["loading"===e&&(0,m.jsx)(a.Spinner,{}),o]})}function _({attributes:e,item:o,imageUrl:n,imageKey:r,itemTitle:t,itemLink:l}){const a=!1!==e.showImage;return(0,m.jsxs)("div",{className:"plm-product-box"+(a?"":" plm-product-box--no-image"),children:[a&&(0,m.jsx)("figure",{className:"plm-product-thumb",children:(0,m.jsx)("a",{rel:"nofollow noopener",href:l,className:"plm-product-thumb-link",target:"_blank",title:t,children:n&&(0,m.jsx)("img",{decoding:"async",src:n,alt:t||"商品画像",width:"128",height:"128",className:"plm-product-thumb-image"},r)})}),(0,m.jsxs)("div",{className:"plm-product-content",children:[(0,m.jsx)("div",{className:"plm-product-title",children:(0,m.jsx)("a",{rel:"nofollow noopener",href:l,className:"plm-product-title-link",target:"_blank",title:t,children:t||""})}),(0,m.jsxs)("div",{className:"plm-product-snippet",children:[!1!==e.showShop&&(o?.shopName||e.shop)&&(0,m.jsx)("div",{className:"plm-product-maker",children:o?.shopName||e.shop}),e.price&&(0,m.jsxs)("div",{className:"plm-product-price",children:[(0,m.jsx)("span",{className:"plm-price-value",children:o?.itemPrice?`￥ ${Number(o.itemPrice).toLocaleString("ja-JP")}`:"価格情報なし"}),(0,m.jsx)("span",{className:"acquired-date",children:o?.itemPrice?`（${(new Date).toLocaleDateString()} 時点）`:""})]}),e.desc&&(0,m.jsx)("div",{className:"plm-product-description",children:e.desc})]}),(()=>{const o=e.kw&&e.kw.split(",").filter(Boolean).length>0?function(e){const o=e.kw.split(",").map((e=>e.trim())).filter(Boolean).join(" "),n=window.ProductLinkMakerSettings||{},r=[];if((e.customButtonsBefore||[]).forEach(((e,o)=>{const n=b(e,"custom-before",o);n&&r.push(n)})),n.amazon&&!1!==e.showAmazon){const e=`https://www.amazon.co.jp/gp/search?keywords=${encodeURIComponent(o)}${n.amazonTrackingId?"&tag="+n.amazonTrackingId:""}`;r.push(C("amazon",e,k))}if(n.rakuten&&!1!==e.showRakuten){const e=encodeURIComponent("https://search.rakuten.co.jp/search/mall/"+o+"/"),t=`https://hb.afl.rakuten.co.jp/hgc/${n.rakutenAffiliateId||""}/?pc=${e}&m=${e}`;r.push(C("rakuten",t,x))}if(n.yahoo&&!1!==e.showYahoo){const e=encodeURIComponent("https://search.shopping.yahoo.co.jp/search?p="+o),t=`https://ck.jp.ap.valuecommerce.com/servlet/referral?sid=${n.yahooSid||""}&pid=${n.yahooPid||""}&vc_url=${e}`;r.push(C("yahoo",t,w))}if(n.mercari&&!1!==e.showMercari){const e=`https://jp.mercari.com/search?afid=${n.mercariId||""}&keyword=${encodeURIComponent(o)}`;r.push(C("mercari",e,f))}if(n.dmm&&!1!==e.showDmm){const e=`https://al.dmm.com/?lurl=https%3A%2F%2Fwww.dmm.com%2Fsearch%2F%3D%2Fsearchstr%3D${encodeURIComponent(o)}%2Fanalyze%3DV1ECCVYAUQQ_%2Flimit%3D30%2Fsort%3Drankprofile%2F&af_id=${n.dmmId||""}&ch=link_tool&ch_id=link`;r.push(C("dmm",e,j))}return(e.customButtonsAfter||[]).forEach(((e,o)=>{const n=b(e,"custom-after",o);n&&r.push(n)})),r}(e):[];return o.length>0?(0,m.jsx)("div",{className:"plm-product-buttons",children:o}):null})()]})]})}const v=JSON.parse('{"UU":"product-link-maker/rakuten"}');(0,r.registerBlockType)(v.UU,{edit:function({attributes:e,setAttributes:o}){const[n,r]=(0,i.useState)(null),[s,p]=(0,i.useState)(!0),[h,u]=(0,i.useState)(null),[k,x]=(0,i.useState)(!1),[w,f]=(0,i.useState)(!1),j=(0,i.useRef)(null),b=(0,i.useRef)(!0),C=window.ProductLinkMakerSettings||{},v=(0,d.useSelect)((e=>{const o=e("core/editor");return o?o.getCurrentPostId():null}),[]),I=(0,i.useCallback)((async()=>{if(!e.id&&!e.no&&!e.kw)return r(null),o((e=>({...e,imageUrl:""}))),p(!1),void f(!0);p(!0),u(null);try{const n=new URLSearchParams({id:e.id||"",kw:e.kw||"",no:e.no||"",post_id:v||""}),t=await c()({path:`/product-link-maker/v1/rakuten/?${n.toString()}`});if(t&&t.Items&&t.Items.length>0&&t.Items[0]?.Item){const e=t.Items[0].Item?.mediumImageUrls?.[0]?.imageUrl||"";r(t.Items[0].Item),o((o=>{const n=o.imageUrl&&""!==o.imageUrl&&!o.imageUrl.includes("thumbnail.image.rakuten.co.jp");return{...o,imageUrl:n?o.imageUrl:e}}))}else t?.error?(r(null),o((e=>({...e,imageUrl:""}))),u(t.error_description||"APIエラーが発生しました。しばらく待ってから再度お試しください。")):(r(null),o((e=>({...e,imageUrl:""}))),u("データが取得できませんでした"))}catch(e){console.error("Rakuten API fetch error:",e),r(null),o((e=>({...e,imageUrl:""})));let n="APIエラーが発生しました。";e.message&&(n+=" "+e.message),e.data?.message&&(n+=" "+e.data.message),u(n)}finally{p(!1),f(!0),b.current&&(b.current=!1)}}),[e.id,e.no,e.kw,v,o]),U=(0,i.useCallback)((async()=>{if(window.confirm("キャッシュを削除して最新データを取得しますか？")){x(!0);try{await c()({path:"/product-link-maker/v1/rakuten-cache/",method:"POST",data:{id:e.id,kw:e.kw,no:e.no}}),await I()}catch(e){console.error("Cache clear error:",e),alert("キャッシュ削除中にエラーが発生しました。")}finally{x(!1)}}}),[e.id,e.kw,e.no,I]);(0,i.useEffect)((()=>(j.current&&clearTimeout(j.current),e.id||e.no||e.kw?j.current=setTimeout((()=>{I()}),1e3):(r(null),p(!1),f(!0)),()=>{j.current&&clearTimeout(j.current)})),[e.id,e.no,e.kw]);const[T,S]=(0,i.useState)(0),B=e.imageUrl||(n&&n.mediumImageUrls&&n.mediumImageUrls[0]?n.mediumImageUrls[0].imageUrl:"");(0,i.useEffect)((()=>{S((e=>e+1))}),[B]);const M=e.title||(n?n.itemName:""),P=n&&(n.affiliateUrl||n.itemUrl)||"#";return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(l.BlockControls,{children:(0,m.jsx)(a.ToolbarGroup,{children:(0,m.jsx)(a.Dropdown,{popoverProps:{placement:"bottom-start"},renderToggle:({isOpen:e,onToggle:o})=>(0,m.jsx)(a.ToolbarButton,{icon:"admin-settings",label:(0,t.__)("表示設定","product-link-maker"),onClick:o,"aria-expanded":e}),renderContent:()=>(0,m.jsxs)(a.MenuGroup,{children:[(0,m.jsx)(a.MenuItem,{icon:!1!==e.showImage?"yes":void 0,isSelected:!1!==e.showImage,onClick:()=>o({showImage:!e.showImage}),children:(0,t.__)("商品画像を表示","product-link-maker")}),(0,m.jsx)(a.MenuItem,{icon:!1!==e.showShop?"yes":void 0,isSelected:!1!==e.showShop,onClick:()=>o({showShop:!e.showShop}),children:(0,t.__)("店名を表示","product-link-maker")}),(0,m.jsx)(a.MenuItem,{icon:e.price?"yes":void 0,isSelected:e.price,onClick:()=>o({price:!e.price}),children:(0,t.__)("価格を表示","product-link-maker")}),C.amazon&&(0,m.jsx)(a.MenuItem,{icon:!1!==e.showAmazon?"yes":void 0,isSelected:!1!==e.showAmazon,onClick:()=>o({showAmazon:!e.showAmazon}),children:(0,t.__)("Amazonボタンを表示","product-link-maker")}),C.rakuten&&(0,m.jsx)(a.MenuItem,{icon:!1!==e.showRakuten?"yes":void 0,isSelected:!1!==e.showRakuten,onClick:()=>o({showRakuten:!e.showRakuten}),children:(0,t.__)("楽天ボタンを表示","product-link-maker")}),C.yahoo&&(0,m.jsx)(a.MenuItem,{icon:!1!==e.showYahoo?"yes":void 0,isSelected:!1!==e.showYahoo,onClick:()=>o({showYahoo:!e.showYahoo}),children:(0,t.__)("Yahoo!ボタンを表示","product-link-maker")}),C.mercari&&(0,m.jsx)(a.MenuItem,{icon:!1!==e.showMercari?"yes":void 0,isSelected:!1!==e.showMercari,onClick:()=>o({showMercari:!e.showMercari}),children:(0,t.__)("メルカリボタンを表示","product-link-maker")}),C.dmm&&(0,m.jsx)(a.MenuItem,{icon:!1!==e.showDmm?"yes":void 0,isSelected:!1!==e.showDmm,onClick:()=>o({showDmm:!e.showDmm}),children:(0,t.__)("DMMボタンを表示","product-link-maker")})]})})})}),(0,m.jsxs)(l.InspectorControls,{children:[(0,m.jsxs)(a.PanelBody,{title:(0,t.__)("商品情報","product-link-maker"),initialOpen:!0,children:[(0,m.jsx)(a.TextControl,{label:(0,t.__)("アイテムコード(商品ID)・商品番号","product-link-maker"),value:e.id||e.no||"",onChange:e=>{e.includes(":")?o({id:e,no:""}):o({no:e,id:""})},placeholder:"shop:12345678 / 1234567890123"}),(0,m.jsx)(a.FormTokenField,{label:(0,t.__)("検索キーワード","product-link-maker"),value:e.kw?e.kw.split(",").filter(Boolean):[],onChange:e=>o({kw:e.join(",")})}),(0,m.jsx)(a.TextControl,{label:(0,t.__)("商品タイトル","product-link-maker"),value:e.title,onChange:e=>o({title:e})}),(0,m.jsx)(a.ToggleControl,{label:(0,t.__)("店名を表示","product-link-maker"),checked:!1!==e.showShop,onChange:e=>o({showShop:e})}),(0,m.jsx)(a.ToggleControl,{label:(0,t.__)("価格を表示","product-link-maker"),checked:e.price,onChange:e=>o({price:e})}),(0,m.jsx)(a.TextareaControl,{label:(0,t.__)("説明文","product-link-maker"),value:e.desc,onChange:e=>o({desc:e})}),(0,m.jsx)("div",{style:{margin:"24px 0 0 0"}}),(0,m.jsx)(a.__experimentalHeading,{style:{fontSize:"11px",fontWeight:"500",marginBottom:"8px"},children:"ボタン表示設定"}),(0,m.jsx)(a.ToggleControl,{label:(0,t.__)("Amazonボタンを表示","product-link-maker"),checked:!1!==e.showAmazon,onChange:e=>o({showAmazon:e})}),(0,m.jsx)(a.ToggleControl,{label:(0,t.__)("楽天ボタンを表示","product-link-maker"),checked:!1!==e.showRakuten,onChange:e=>o({showRakuten:e})}),(0,m.jsx)(a.ToggleControl,{label:(0,t.__)("Yahoo!ボタンを表示","product-link-maker"),checked:!1!==e.showYahoo,onChange:e=>o({showYahoo:e})}),(0,m.jsx)(a.ToggleControl,{label:(0,t.__)("メルカリボタンを表示","product-link-maker"),checked:!1!==e.showMercari,onChange:e=>o({showMercari:e})}),(0,m.jsx)(a.ToggleControl,{label:(0,t.__)("DMMボタンを表示","product-link-maker"),checked:!1!==e.showDmm,onChange:e=>o({showDmm:e})})]}),(0,m.jsx)(a.PanelBody,{title:(0,t.__)("カスタムボタン（前）","product-link-maker"),initialOpen:!0,children:(0,m.jsx)(g,{buttons:e.customButtonsBefore||[],onChange:e=>o({customButtonsBefore:e}),label:"既存のボタンの前に表示されるカスタムボタンを追加できます"})}),(0,m.jsx)(a.PanelBody,{title:(0,t.__)("カスタムボタン（後）","product-link-maker"),initialOpen:!0,children:(0,m.jsx)(g,{buttons:e.customButtonsAfter||[],onChange:e=>o({customButtonsAfter:e}),label:"既存のボタンの後に表示されるカスタムボタンを追加できます"})}),(0,m.jsxs)(a.PanelBody,{title:(0,t.__)("商品画像","product-link-maker"),initialOpen:!0,children:[(0,m.jsx)(a.ToggleControl,{label:(0,t.__)("商品画像を表示","product-link-maker"),checked:!1!==e.showImage,onChange:e=>o({showImage:e})}),!1!==e.showImage&&(0,m.jsx)(l.MediaUploadCheck,{children:(0,m.jsxs)("div",{style:{marginBottom:"0",marginTop:"16px"},children:[(""!==e.imageUrl?e.imageUrl:n?.mediumImageUrls?.[0]?.imageUrl)&&(0,m.jsx)("div",{style:{marginBottom:"10px",display:"flex",justifyContent:"center",border:"1px solid #ddd"},children:(0,m.jsx)("img",{src:""!==e.imageUrl?e.imageUrl:n?.mediumImageUrls?.[0]?.imageUrl,alt:"",style:{display:"block"}})}),(0,m.jsx)(l.MediaUpload,{onSelect:e=>o({imageUrl:e.url||""}),allowedTypes:["image"],render:({open:r})=>(0,m.jsxs)(a.Flex,{children:[(0,m.jsx)(a.Button,{onClick:r,variant:"secondary",children:"画像を選択"}),e.imageUrl&&""!==e.imageUrl&&e.imageUrl!==n?.mediumImageUrls?.[0]?.imageUrl&&(0,m.jsx)(a.Button,{style:{marginTop:4},onClick:()=>o({imageUrl:""}),isDestructive:!0,children:(0,t.__)("画像をリセット","product-link-maker")})]})})]})})]}),(0,m.jsx)(a.PanelBody,{title:(0,t.__)("API設定","product-link-maker"),initialOpen:!1,children:(0,m.jsx)(a.Button,{href:`${window.location.origin}/wp-admin/options-general.php?page=product-link-maker`,target:"_blank",variant:"link",icon:"external",style:{textDecoration:"none",color:"#2271b1",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",padding:"8px 12px",border:"1px solid #2271b1",borderRadius:"4px",justifyContent:"center",transition:"all 0.2s ease",marginTop:"16px",marginBottom:"0"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#2271b1",e.currentTarget.style.color="#fff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#2271b1"},children:(0,t.__)("アフィリエイト設定を開く","product-link-maker")})})]}),(0,m.jsx)("div",{...(0,l.useBlockProps)(),children:s?(0,m.jsx)(y,{type:"loading",message:"Loading..."}):h?(0,m.jsx)(y,{type:"error",message:h}):e.id||e.no||e.kw?!w||!n&&(e.id||e.no)?(0,m.jsx)(y,{type:"loading",message:"Loading..."}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(_,{attributes:e,item:n,imageUrl:B,imageKey:T,itemTitle:M,itemLink:P}),n&&(0,m.jsxs)("div",{className:"plm-admin-info",children:[(0,m.jsx)(a.Button,{variant:"secondary",onClick:U,disabled:k,isBusy:k,size:"small",children:k?"削除中...":"キャッシュ更新"}),n?.affiliateRate&&(0,m.jsxs)("span",{children:["料率: ",n.affiliateRate,"%"]})]})]}):(0,m.jsx)(y,{type:"empty",message:"商品情報を設定してください"})})]})}})}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var l=n[e]={exports:{}};return o[e](l,l.exports,r),l.exports}r.m=o,e=[],r.O=(o,n,t,l)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,t,l]=e[d],i=!0,s=0;s<n.length;s++)(!1&l||a>=l)&&Object.keys(r.O).every((e=>r.O[e](n[s])))?n.splice(s--,1):(i=!1,l<a&&(a=l));if(i){e.splice(d--,1);var c=t();void 0!==c&&(o=c)}}return o}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[n,t,l]},r.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return r.d(o,{a:o}),o},r.d=(e,o)=>{for(var n in o)r.o(o,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},r.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),(()=>{var e={68:0,708:0};r.O.j=o=>0===e[o];var o=(o,n)=>{var t,l,[a,i,s]=n,c=0;if(a.some((o=>0!==e[o]))){for(t in i)r.o(i,t)&&(r.m[t]=i[t]);if(s)var d=s(r)}for(o&&o(n);c<a.length;c++)l=a[c],r.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return r.O(d)},n=globalThis.webpackChunkproduct_link_maker=globalThis.webpackChunkproduct_link_maker||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))})();var t=r.O(void 0,[708],(()=>r(727)));t=r.O(t)})();