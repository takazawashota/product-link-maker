(()=>{"use strict";var e,o={441:(e,o,n)=>{const r=window.wp.blocks,a=window.wp.i18n,t=window.wp.blockEditor,l=window.wp.components,i=window.wp.element,s=window.wp.apiFetch;var c=n.n(s);const d=window.ReactJSXRuntime,m=JSON.parse('{"UU":"create-block/rakuten"}');(0,r.registerBlockType)(m.UU,{edit:function({attributes:e,setAttributes:o}){const[n,r]=(0,i.useState)(null),[s,m]=(0,i.useState)(!1),[p,h]=(0,i.useState)(null),u=(0,i.useRef)(null),g=(0,i.useCallback)((async()=>{if(!e.id&&!e.no&&!e.kw)return r(null),void o((e=>({...e,imageUrl:""})));m(!0),h(null);try{const n=await c()({path:`/myplugin/v1/rakuten/?id=${encodeURIComponent(e.id||"")}&kw=${encodeURIComponent(e.kw||"")}&no=${encodeURIComponent(e.no||"")}`});if(n?.Items?.[0]?.Item){const e=n.Items[0].Item;r(e);const a=e.mediumImageUrls?.[0]?.imageUrl||"";o((e=>({...e,imageUrl:a}))),h(null)}else n?.error?(r(null),o((e=>({...e,imageUrl:""}))),h("APIエラー: "+(n.error_description||"リクエスト制限に達しました。しばらく待ってから再度お試しください。"))):(r(null),o((e=>({...e,imageUrl:""}))),h("データが取得できませんでした"))}catch(e){console.error("Rakuten API fetch error:",e),r(null),o((e=>({...e,imageUrl:""}))),h("APIエラーが発生しました。しばらく待ってから再度お試しください。")}finally{m(!1)}}),[e.id,e.no,e.kw,o]),k=(0,i.useCallback)((async()=>{if(window.confirm("本当にキャッシュを削除してもいいですか？"))try{await c()({path:"/myplugin/v1/rakuten-cache/",method:"POST",data:{id:e.id,kw:e.kw,no:e.no}}),g()}catch(e){console.error("Cache clear error:",e)}}),[e.id,e.kw,e.no,g]);(0,i.useEffect)((()=>(u.current&&clearTimeout(u.current),e.id||e.no||e.kw?u.current=setTimeout((()=>{g()}),1e3):r(null),()=>{u.current&&clearTimeout(u.current)})),[e.id,e.no,e.kw]);const[x,f]=(0,i.useState)(0),w=e.imageUrl||(n&&n.mediumImageUrls&&n.mediumImageUrls[0]?n.mediumImageUrls[0].imageUrl:"");(0,i.useEffect)((()=>{f((e=>e+1))}),[w]);const b=e.title||(n?n.itemName:""),j=n&&(n.affiliateUrl||n.itemUrl)||"#";return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(t.InspectorControls,{children:[(0,d.jsxs)(l.PanelBody,{title:(0,a.__)("商品情報設定","rakuten"),initialOpen:!0,children:[(0,d.jsx)(l.TextControl,{label:(0,a.__)("アイテムコード（ID）","rakuten"),help:e.no?(0,a.__)("商品番号が入力されている場合は入力できません","rakuten"):"",value:e.id,disabled:!!e.no,onChange:e=>{o({id:e,no:""})},placeholder:"book:11830886",style:e.no?{backgroundColor:"#f5f5f5",color:"#aaa"}:{}}),(0,d.jsx)(l.TextControl,{label:(0,a.__)("商品番号","rakuten"),help:e.id?(0,a.__)("アイテムコード（ID）が入力されている場合は入力できません","rakuten"):"",value:e.no,disabled:!!e.id,onChange:e=>{o({no:e,id:""})},placeholder:"4902102072625",style:e.id?{backgroundColor:"#f5f5f5",color:"#aaa"}:{}}),(0,d.jsx)(l.FormTokenField,{label:(0,a.__)("キーワード指定","rakuten"),value:e.kw?e.kw.split(",").filter(Boolean):[],onChange:e=>o({kw:e.join(",")}),placeholder:(0,a.__)("キーワードを入力してEnter","rakuten")}),(0,d.jsx)(l.TextControl,{label:(0,a.__)("ショップコード","rakuten"),value:e.shop,onChange:e=>o({shop:e})}),(0,d.jsx)(l.FormTokenField,{label:(0,a.__)("サーチ","rakuten"),value:e.search?e.search.split(",").filter(Boolean):[],onChange:e=>o({search:e.join(",")}),placeholder:(0,a.__)("サーチを入力してEnter","rakuten")}),(0,d.jsx)(l.TextareaControl,{label:(0,a.__)("タイトル","rakuten"),value:e.title,onChange:e=>o({title:e})}),(0,d.jsx)(l.ToggleControl,{label:(0,a.__)("店名表示","rakuten"),checked:!1!==e.showShop,onChange:e=>o({showShop:e})}),(0,d.jsx)(l.ToggleControl,{label:(0,a.__)("価格表示","rakuten"),checked:e.price,onChange:e=>o({price:e})}),(0,d.jsx)(l.TextareaControl,{label:(0,a.__)("説明文","rakuten"),value:e.desc,onChange:e=>o({desc:e})}),(0,d.jsx)(l.__experimentalHeading,{children:"画像アップロード"}),(0,d.jsx)(t.MediaUploadCheck,{children:(0,d.jsxs)("div",{style:{marginBottom:"0"},children:[(""!==e.imageUrl?e.imageUrl:n?.mediumImageUrls?.[0]?.imageUrl)&&(0,d.jsx)("div",{style:{marginBottom:"10px",display:"flex",justifyContent:"center",backgroundColor:"#eee"},children:(0,d.jsx)("img",{src:""!==e.imageUrl?e.imageUrl:n?.mediumImageUrls?.[0]?.imageUrl,alt:"",style:{display:"block"}})}),(0,d.jsx)(t.MediaUpload,{onSelect:e=>o({imageUrl:e.url||""}),allowedTypes:["image"],render:({open:n})=>(0,d.jsxs)(l.Flex,{children:[(0,d.jsx)(l.Button,{onClick:n,variant:"secondary",children:"画像を選択"}),e.imageUrl&&(0,d.jsx)(l.Button,{style:{marginTop:4},onClick:()=>o({imageUrl:""}),isDestructive:!0,children:(0,a.__)("画像をリセット","rakuten")})]})})]})}),(0,d.jsx)("div",{style:{margin:"24px 0 0 0"}}),(0,d.jsx)(l.__experimentalHeading,{children:"ボタン表示設定"}),(0,d.jsx)(l.ToggleControl,{label:(0,a.__)("Amazonボタンを表示","rakuten"),checked:!1!==e.showAmazon,onChange:e=>o({showAmazon:e})}),(0,d.jsx)(l.ToggleControl,{label:(0,a.__)("楽天ボタンを表示","rakuten"),checked:!1!==e.showRakuten,onChange:e=>o({showRakuten:e})}),(0,d.jsx)(l.ToggleControl,{label:(0,a.__)("Yahoo!ボタンを表示","rakuten"),checked:!1!==e.showYahoo,onChange:e=>o({showYahoo:e})}),(0,d.jsx)(l.ToggleControl,{label:(0,a.__)("メルカリボタンを表示","rakuten"),checked:!1!==e.showMercari,onChange:e=>o({showMercari:e})}),(0,d.jsx)(l.ToggleControl,{label:(0,a.__)("DMMボタンを表示","rakuten"),checked:!1!==e.showDmm,onChange:e=>o({showDmm:e})})]}),(0,d.jsx)(l.PanelBody,{title:(0,a.__)("アフィリエイト設定","rakuten"),initialOpen:!1,children:(0,d.jsx)(l.Button,{href:`${window.location.origin}/wp-admin/options-general.php?page=product-link-maker`,target:"_blank",className:"",variant:"primary",icon:"admin-generic",style:{marginTop:"5px",width:"100%",textAlign:"center"},children:(0,a.__)("アフィリエイト設定","rakuten")})})]}),(0,d.jsx)("div",{...(0,t.useBlockProps)(),children:s?(0,d.jsx)("div",{style:{padding:"32px",textAlign:"center",color:"#888",backgroundColor:"#f5f5f5",border:"1px dashed #ccc",borderRadius:"4px"},children:"Loading..."}):p?(0,d.jsx)("div",{style:{padding:"32px",textAlign:"center",color:"#d63638",backgroundColor:"#fff0f0",border:"1px solid #d63638",borderRadius:"4px"},children:p}):e.id||e.no||e.kw?(0,d.jsxs)("div",{className:"rakuten-item-box product-item-box no-icon pis-m",children:[(0,d.jsx)("figure",{className:"rakuten-item-thumb product-item-thumb",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:j,className:"rakuten-item-thumb-link product-item-thumb-link",target:"_blank",title:b,children:w&&(0,d.jsx)("img",{decoding:"async",src:w,alt:b||"商品画像",width:"128",height:"128",className:"rakuten-item-thumb-image product-item-thumb-image"},x)})}),(0,d.jsxs)("div",{className:"rakuten-item-content product-item-content cf",children:[(0,d.jsx)("div",{className:"rakuten-item-title product-item-title",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:j,className:"rakuten-item-title-link product-item-title-link",target:"_blank",title:b,children:b||""})}),(0,d.jsxs)("div",{className:"rakuten-item-snippet product-item-snippet",children:[!1!==e.showShop&&(n?.shopName||e.shop)&&(0,d.jsx)("div",{className:"rakuten-item-maker product-item-maker",children:n?.shopName||e.shop}),e.price&&(0,d.jsxs)("div",{className:"product-item-price",children:[(0,d.jsx)("span",{className:"item-price",children:n?.itemPrice?`￥ ${n.itemPrice}`:"価格情報なし"}),(0,d.jsx)("span",{className:"acquired-date",children:n?.itemPrice?`（${(new Date).toLocaleDateString()} 時点）`:""})]}),e.desc&&(0,d.jsx)("div",{className:"product-item-description",children:e.desc})]}),(0,d.jsx)("div",{className:"amazon-item-buttons product-item-buttons",children:e.kw&&e.kw.split(",").filter(Boolean).length>0&&(()=>{const o=e.kw.split(",").map((e=>e.trim())).filter(Boolean).join(" "),n=window.MyAffiliateSettings||{},r=[];if(n.amazon&&!1!==e.showAmazon&&r.push((0,d.jsx)("div",{className:"shoplinkamazon",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://www.amazon.co.jp/gp/search?keywords=${encodeURIComponent(o)}`,target:"_blank",style:{backgroundColor:"#f79901",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",marginRight:"8px",textDecoration:"none"},children:"Amazon"})},"amazon")),n.rakuten&&!1!==e.showRakuten&&r.push((0,d.jsx)("div",{className:"shoplinkrakuten",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://search.rakuten.co.jp/search/mall/${encodeURIComponent(o)}/`,target:"_blank",style:{backgroundColor:"#bf0000",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",marginRight:"8px",textDecoration:"none"},children:"楽天"})},"rakuten")),n.yahoo&&!1!==e.showYahoo&&r.push((0,d.jsx)("div",{className:"shoplinkyahoo",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://search.shopping.yahoo.co.jp/search?p=${encodeURIComponent(o)}`,target:"_blank",style:{backgroundColor:"#e60033",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",marginRight:"8px",textDecoration:"none"},children:"Yahoo!ショッピング"})},"yahoo")),n.mercari&&!1!==e.showMercari&&r.push((0,d.jsx)("div",{className:"shoplinkmercari",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://jp.mercari.com/search?keyword=${encodeURIComponent(o)}`,target:"_blank",style:{backgroundColor:"#4dc9ff",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",marginRight:"8px",textDecoration:"none"},children:"メルカリ"})},"mercari")),n.dmm&&!1!==e.showDmm){const e=`https://www.dmm.com/search/=/searchstr=${encodeURIComponent(o)}/analyze=V1ECCVYAUQQ_/limit=30/sort=rankprofile/?utm_medium=dmm_affiliate&utm_source=dummy&utm_term=dmm.com&utm_campaign=affiliate_link_tool&utm_content=link`;r.push((0,d.jsx)("div",{className:"shoplinkdmm",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:e,target:"_blank",style:{backgroundColor:"#00bcd4",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",marginRight:"6px",textDecoration:"none"},children:"DMM"})},"dmm"))}return r})()}),(0,d.jsxs)("div",{className:"product-item-admin",children:[(0,d.jsx)(l.Button,{variant:"link",onClick:k,style:{color:"#0073aa",textDecoration:"underline",cursor:"pointer",padding:0,marginRight:"10px"},children:"キャッシュ削除"}),(0,d.jsxs)("span",{className:"product-affiliate-rate",children:["料率：",n?.affiliateRate?`${n.affiliateRate}%`:""]})]})]})]}):(0,d.jsx)("div",{style:{padding:"32px",textAlign:"center",color:"#666",backgroundColor:"#f5f5f5",border:"1px dashed #ccc",borderRadius:"4px"},children:"商品情報を設定してください"})})]})}})}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var t=n[e]={exports:{}};return o[e](t,t.exports,r),t.exports}r.m=o,e=[],r.O=(o,n,a,t)=>{if(!n){var l=1/0;for(d=0;d<e.length;d++){for(var[n,a,t]=e[d],i=!0,s=0;s<n.length;s++)(!1&t||l>=t)&&Object.keys(r.O).every((e=>r.O[e](n[s])))?n.splice(s--,1):(i=!1,t<l&&(l=t));if(i){e.splice(d--,1);var c=a();void 0!==c&&(o=c)}}return o}t=t||0;for(var d=e.length;d>0&&e[d-1][2]>t;d--)e[d]=e[d-1];e[d]=[n,a,t]},r.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return r.d(o,{a:o}),o},r.d=(e,o)=>{for(var n in o)r.o(o,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},r.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),(()=>{var e={68:0,708:0};r.O.j=o=>0===e[o];var o=(o,n)=>{var a,t,[l,i,s]=n,c=0;if(l.some((o=>0!==e[o]))){for(a in i)r.o(i,a)&&(r.m[a]=i[a]);if(s)var d=s(r)}for(o&&o(n);c<l.length;c++)t=l[c],r.o(e,t)&&e[t]&&e[t][0](),e[t]=0;return r.O(d)},n=globalThis.webpackChunkproduct_link_maker=globalThis.webpackChunkproduct_link_maker||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))})();var a=r.O(void 0,[708],(()=>r(441)));a=r.O(a)})();