(()=>{"use strict";var e,o={441:(e,o,r)=>{const n=window.wp.blocks,t=window.wp.i18n,l=window.wp.blockEditor,a=window.wp.components,i=window.wp.element,s=window.wp.apiFetch;var c=r.n(s);const d=window.ReactJSXRuntime,m="#2196f3",p={color:"#fff",borderRadius:"3px",padding:"8px 16px",display:"inline-flex",alignItems:"center",justifyContent:"center",textDecoration:"none",fontSize:"15px",fontWeight:"600",whiteSpace:"nowrap",minWidth:"85px",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},u={padding:"32px",textAlign:"center",borderRadius:"4px"};function h({buttons:e,onChange:o,label:r}){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{style:{fontSize:"13px",color:"#757575",marginTop:0},children:r}),e.map(((r,n)=>(0,d.jsxs)(a.Card,{style:{marginBottom:"16px",border:"1px solid #ddd"},children:[(0,d.jsx)(a.CardHeader,{children:(0,d.jsxs)(a.Flex,{justify:"space-between",align:"center",children:[(0,d.jsxs)("span",{style:{fontWeight:600},children:["ボタン ",n+1]}),(0,d.jsx)(a.Button,{isDestructive:!0,isSmall:!0,onClick:()=>{const r=[...e];r.splice(n,1),o(r)},icon:"trash"})]})}),(0,d.jsxs)(a.CardBody,{children:[(0,d.jsx)(a.TextControl,{label:"ボタンテキスト",value:r.text||"",onChange:r=>{const t=[...e];t[n]={...t[n],text:r},o(t)},placeholder:"例: 公式サイト"}),(0,d.jsx)(a.TextControl,{label:"リンクURL",value:r.url||"",onChange:r=>{const t=[...e];t[n]={...t[n],url:r},o(t)},placeholder:"https://example.com"}),(0,d.jsx)(a.ToggleControl,{label:"別タブで開く",checked:!1!==r.openInNewTab,onChange:r=>{const t=[...e];t[n]={...t[n],openInNewTab:r},o(t)}}),(0,d.jsxs)("div",{style:{marginTop:"12px"},children:[(0,d.jsxs)(a.Button,{variant:"secondary",onClick:()=>{const r=[...e];r[n]={...r[n],showColorPicker:!r[n].showColorPicker},o(r)},style:{width:"100%",marginBottom:"8px"},children:[r.showColorPicker?"色を選択中":"ボタンの色を選択",(0,d.jsx)("span",{style:{marginLeft:"8px",width:"20px",height:"20px",backgroundColor:r.color||m,display:"inline-block",borderRadius:"3px",border:"1px solid #ddd",verticalAlign:"middle"}})]}),r.showColorPicker&&(0,d.jsx)(a.ColorPicker,{color:r.color||m,onChange:r=>{const t=[...e];t[n]={...t[n],color:r},o(t)},enableAlpha:!0,defaultValue:m})]})]})]},n))),(0,d.jsx)(a.Button,{variant:"secondary",onClick:()=>{const r=[...e,{text:"",url:"",openInNewTab:!0,color:m}];o(r)},icon:"plus",style:{width:"100%",justifyContent:"center"},children:"ボタンを追加"})]})}const k={backgroundColor:"#ff9900",text:"Amazon"},g={backgroundColor:"#bf0000",text:"楽天"},x={backgroundColor:"#ff0033",text:"Yahoo!ショッピング"},f={backgroundColor:"#4dc9ff",text:"メルカリ"},w={backgroundColor:"#00bcd4",text:"DMM"};function j(e,o,r){return e.text&&e.url?(0,d.jsx)("div",{className:"plm-shop-custom",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:e.url,target:!1!==e.openInNewTab?"_blank":"_self",style:{...p,backgroundColor:e.color||m},children:e.text})},`${o}-${r}`):null}function b(e,o,r){return(0,d.jsx)("div",{className:`plm-shop-${e}`,children:(0,d.jsx)("a",{rel:"nofollow noopener",href:o,target:"_blank",style:{...p,backgroundColor:r.backgroundColor},children:r.text})},e)}function C({type:e,message:o}){const r={loading:{...u,color:"#888",backgroundColor:"#f5f5f5",border:"1px dashed #ccc"},error:{...u,color:"#d63638",backgroundColor:"#fff0f0",border:"1px solid #d63638"},empty:{...u,color:"#666",backgroundColor:"#f5f5f5",border:"1px dashed #ccc"}};return(0,d.jsx)("div",{style:r[e],children:o})}function _(e){const o=e.kw.split(",").map((e=>e.trim())).filter(Boolean),r=o.join(" "),n=window.ProductLinkMakerSettings||{},t=[];if((e.customButtonsBefore||[]).forEach(((e,o)=>{const r=j(e,"custom-before",o);r&&t.push(r)})),n.amazon&&!1!==e.showAmazon&&t.push(b("amazon",`https://www.amazon.co.jp/gp/search?keywords=${encodeURIComponent(r)}`,k)),n.rakuten&&!1!==e.showRakuten&&t.push(b("rakuten",`https://search.rakuten.co.jp/search/mall/${encodeURIComponent(r)}/`,g)),n.yahoo&&!1!==e.showYahoo&&t.push(b("yahoo",`https://search.shopping.yahoo.co.jp/search?p=${encodeURIComponent(r)}`,x)),n.mercari&&!1!==e.showMercari&&t.push(b("mercari",`https://jp.mercari.com/search?keyword=${encodeURIComponent(r)}`,f)),n.dmm&&!1!==e.showDmm){const e=`https://www.dmm.com/search/=/searchstr=${o.map((e=>encodeURIComponent(e))).join(" ")}/analyze=V1ECCVYAUQQ_/limit=30/sort=rankprofile/?utm_medium=dmm_affiliate&utm_source=dummy&utm_term=dmm.com&utm_campaign=affiliate_link_tool&utm_content=link`;t.push(b("dmm",e,w))}return(e.customButtonsAfter||[]).forEach(((e,o)=>{const r=j(e,"custom-after",o);r&&t.push(r)})),t}function y({attributes:e,item:o,imageUrl:r,imageKey:n,itemTitle:t,itemLink:l}){return(0,d.jsxs)("div",{className:"plm-product-box",children:[(0,d.jsx)("figure",{className:"plm-product-thumb",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:l,className:"plm-product-thumb-link",target:"_blank",title:t,children:r&&(0,d.jsx)("img",{decoding:"async",src:r,alt:t||"商品画像",width:"128",height:"128",className:"plm-product-thumb-image"},n)})}),(0,d.jsxs)("div",{className:"plm-product-content",children:[(0,d.jsx)("div",{className:"plm-product-title",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:l,className:"plm-product-title-link",target:"_blank",title:t,children:t||""})}),(0,d.jsxs)("div",{className:"plm-product-snippet",children:[!1!==e.showShop&&(o?.shopName||e.shop)&&(0,d.jsx)("div",{className:"plm-product-maker",children:o?.shopName||e.shop}),e.price&&(0,d.jsxs)("div",{className:"plm-product-price",children:[(0,d.jsx)("span",{className:"plm-price-value",children:o?.itemPrice?`￥ ${o.itemPrice}`:"価格情報なし"}),(0,d.jsx)("span",{className:"acquired-date",children:o?.itemPrice?`（${(new Date).toLocaleDateString()} 時点）`:""})]}),e.desc&&(0,d.jsx)("div",{className:"plm-product-description",children:e.desc})]}),(0,d.jsx)("div",{className:"plm-product-buttons",children:e.kw&&e.kw.split(",").filter(Boolean).length>0&&_(e)})]})]})}const v=JSON.parse('{"UU":"product-link-maker/rakuten"}');(0,n.registerBlockType)(v.UU,{edit:function({attributes:e,setAttributes:o}){const[r,n]=(0,i.useState)(null),[s,m]=(0,i.useState)(!1),[p,u]=(0,i.useState)(null),[k,g]=(0,i.useState)(!1),x=(0,i.useRef)(null),f=(0,i.useCallback)((async()=>{if(!e.id&&!e.no&&!e.kw)return n(null),void o((e=>({...e,imageUrl:""})));m(!0),u(null);try{const r=await c()({path:`/product-link-maker/v1/rakuten/?id=${encodeURIComponent(e.id||"")}&kw=${encodeURIComponent(e.kw||"")}&no=${encodeURIComponent(e.no||"")}`});if(r?.Items?.[0]?.Item){const e=r.Items[0].Item;n(e);const t=e.mediumImageUrls?.[0]?.imageUrl||"";o((e=>({...e,imageUrl:t}))),u(null)}else r?.error?(n(null),o((e=>({...e,imageUrl:""}))),u("APIエラー: "+(r.error_description||"リクエスト制限に達しました。しばらく待ってから再度お試しください。"))):(n(null),o((e=>({...e,imageUrl:""}))),u("データが取得できませんでした"))}catch(e){console.error("Rakuten API fetch error:",e),n(null),o((e=>({...e,imageUrl:""}))),u("APIエラーが発生しました。しばらく待ってから再度お試しください。")}finally{m(!1)}}),[e.id,e.no,e.kw,o]),w=(0,i.useCallback)((async()=>{if(window.confirm("キャッシュを削除して最新データを取得しますか？")){g(!0);try{await c()({path:"/product-link-maker/v1/rakuten-cache/",method:"POST",data:{id:e.id,kw:e.kw,no:e.no}}),await f()}catch(e){console.error("Cache clear error:",e),alert("キャッシュ削除中にエラーが発生しました。")}finally{g(!1)}}}),[e.id,e.kw,e.no,f]);(0,i.useEffect)((()=>(x.current&&clearTimeout(x.current),e.id||e.no||e.kw?x.current=setTimeout((()=>{f()}),1e3):n(null),()=>{x.current&&clearTimeout(x.current)})),[e.id,e.no,e.kw]);const[j,b]=(0,i.useState)(0),_=e.imageUrl||(r&&r.mediumImageUrls&&r.mediumImageUrls[0]?r.mediumImageUrls[0].imageUrl:"");(0,i.useEffect)((()=>{b((e=>e+1))}),[_]);const v=e.title||(r?r.itemName:""),U=r&&(r.affiliateUrl||r.itemUrl)||"#";return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(l.InspectorControls,{children:[(0,d.jsxs)(a.PanelBody,{title:(0,t.__)("商品情報設定","product-link-maker"),initialOpen:!0,children:[(0,d.jsx)(a.TextControl,{label:(0,t.__)("アイテムコード（ID）","product-link-maker"),help:e.no?(0,t.__)("商品番号が入力されている場合は入力できません","product-link-maker"):"",value:e.id,disabled:!!e.no,onChange:e=>{o({id:e,no:""})},placeholder:"book:11830886",style:e.no?{backgroundColor:"#f5f5f5",color:"#aaa"}:{}}),(0,d.jsx)(a.TextControl,{label:(0,t.__)("商品番号","product-link-maker"),help:e.id?(0,t.__)("アイテムコード（ID）が入力されている場合は入力できません","product-link-maker"):"",value:e.no,disabled:!!e.id,onChange:e=>{o({no:e,id:""})},placeholder:"4902102072625",style:e.id?{backgroundColor:"#f5f5f5",color:"#aaa"}:{}}),(0,d.jsx)(a.FormTokenField,{label:(0,t.__)("キーワード指定","product-link-maker"),value:e.kw?e.kw.split(",").filter(Boolean):[],onChange:e=>o({kw:e.join(",")}),placeholder:(0,t.__)("キーワードを入力してEnter","product-link-maker")}),(0,d.jsx)(a.TextControl,{label:(0,t.__)("ショップコード","product-link-maker"),value:e.shop,onChange:e=>o({shop:e})}),(0,d.jsx)(a.FormTokenField,{label:(0,t.__)("サーチ","product-link-maker"),value:e.search?e.search.split(",").filter(Boolean):[],onChange:e=>o({search:e.join(",")}),placeholder:(0,t.__)("サーチを入力してEnter","product-link-maker")}),(0,d.jsx)(a.TextareaControl,{label:(0,t.__)("タイトル","product-link-maker"),value:e.title,onChange:e=>o({title:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,t.__)("店名表示","product-link-maker"),checked:!1!==e.showShop,onChange:e=>o({showShop:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,t.__)("価格表示","product-link-maker"),checked:e.price,onChange:e=>o({price:e})}),(0,d.jsx)(a.TextareaControl,{label:(0,t.__)("説明文","product-link-maker"),value:e.desc,onChange:e=>o({desc:e})}),(0,d.jsx)(a.__experimentalHeading,{children:"画像アップロード"}),(0,d.jsx)(l.MediaUploadCheck,{children:(0,d.jsxs)("div",{style:{marginBottom:"0"},children:[(""!==e.imageUrl?e.imageUrl:r?.mediumImageUrls?.[0]?.imageUrl)&&(0,d.jsx)("div",{style:{marginBottom:"10px",display:"flex",justifyContent:"center",backgroundColor:"#eee"},children:(0,d.jsx)("img",{src:""!==e.imageUrl?e.imageUrl:r?.mediumImageUrls?.[0]?.imageUrl,alt:"",style:{display:"block"}})}),(0,d.jsx)(l.MediaUpload,{onSelect:e=>o({imageUrl:e.url||""}),allowedTypes:["image"],render:({open:r})=>(0,d.jsxs)(a.Flex,{children:[(0,d.jsx)(a.Button,{onClick:r,variant:"secondary",children:"画像を選択"}),e.imageUrl&&(0,d.jsx)(a.Button,{style:{marginTop:4},onClick:()=>o({imageUrl:""}),isDestructive:!0,children:(0,t.__)("画像をリセット","product-link-maker")})]})})]})}),(0,d.jsx)("div",{style:{margin:"24px 0 0 0"}}),(0,d.jsx)(a.__experimentalHeading,{children:"ボタン表示設定"}),(0,d.jsx)(a.ToggleControl,{label:(0,t.__)("Amazonボタンを表示","product-link-maker"),checked:!1!==e.showAmazon,onChange:e=>o({showAmazon:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,t.__)("楽天ボタンを表示","product-link-maker"),checked:!1!==e.showRakuten,onChange:e=>o({showRakuten:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,t.__)("Yahoo!ボタンを表示","product-link-maker"),checked:!1!==e.showYahoo,onChange:e=>o({showYahoo:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,t.__)("メルカリボタンを表示","product-link-maker"),checked:!1!==e.showMercari,onChange:e=>o({showMercari:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,t.__)("DMMボタンを表示","product-link-maker"),checked:!1!==e.showDmm,onChange:e=>o({showDmm:e})})]}),(0,d.jsx)(a.PanelBody,{title:(0,t.__)("カスタムボタン（前）","product-link-maker"),initialOpen:!0,children:(0,d.jsx)(h,{buttons:e.customButtonsBefore||[],onChange:e=>o({customButtonsBefore:e}),label:"既存のボタンの前に表示されるカスタムボタンを追加できます"})}),(0,d.jsx)(a.PanelBody,{title:(0,t.__)("カスタムボタン（後）","product-link-maker"),initialOpen:!0,children:(0,d.jsx)(h,{buttons:e.customButtonsAfter||[],onChange:e=>o({customButtonsAfter:e}),label:"既存のボタンの後に表示されるカスタムボタンを追加できます"})}),(0,d.jsx)(a.PanelBody,{title:(0,t.__)("アフィリエイト設定","product-link-maker"),initialOpen:!1,children:(0,d.jsx)(a.Button,{href:`${window.location.origin}/wp-admin/options-general.php?page=product-link-maker`,target:"_blank",className:"",variant:"primary",icon:"admin-generic",style:{marginTop:"5px",width:"100%",textAlign:"center"},children:(0,t.__)("アフィリエイト設定","product-link-maker")})})]}),(0,d.jsx)("div",{...(0,l.useBlockProps)(),children:s?(0,d.jsx)(C,{type:"loading",message:"Loading..."}):p?(0,d.jsx)(C,{type:"error",message:p}):e.id||e.no||e.kw?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(y,{attributes:e,item:r,imageUrl:_,imageKey:j,itemTitle:v,itemLink:U}),r&&(0,d.jsxs)("div",{className:"plm-admin-info",children:[(0,d.jsx)(a.Button,{variant:"secondary",onClick:w,disabled:k,isBusy:k,size:"small",children:k?"削除中...":"キャッシュ更新"}),r?.affiliateRate&&(0,d.jsxs)("span",{children:["料率: ",r.affiliateRate,"%"]})]})]}):(0,d.jsx)(C,{type:"empty",message:"商品情報を設定してください"})})]})}})}},r={};function n(e){var t=r[e];if(void 0!==t)return t.exports;var l=r[e]={exports:{}};return o[e](l,l.exports,n),l.exports}n.m=o,e=[],n.O=(o,r,t,l)=>{if(!r){var a=1/0;for(d=0;d<e.length;d++){for(var[r,t,l]=e[d],i=!0,s=0;s<r.length;s++)(!1&l||a>=l)&&Object.keys(n.O).every((e=>n.O[e](r[s])))?r.splice(s--,1):(i=!1,l<a&&(a=l));if(i){e.splice(d--,1);var c=t();void 0!==c&&(o=c)}}return o}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[r,t,l]},n.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return n.d(o,{a:o}),o},n.d=(e,o)=>{for(var r in o)n.o(o,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},n.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),(()=>{var e={68:0,708:0};n.O.j=o=>0===e[o];var o=(o,r)=>{var t,l,[a,i,s]=r,c=0;if(a.some((o=>0!==e[o]))){for(t in i)n.o(i,t)&&(n.m[t]=i[t]);if(s)var d=s(n)}for(o&&o(r);c<a.length;c++)l=a[c],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(d)},r=globalThis.webpackChunkproduct_link_maker=globalThis.webpackChunkproduct_link_maker||[];r.forEach(o.bind(null,0)),r.push=o.bind(null,r.push.bind(r))})();var t=n.O(void 0,[708],(()=>n(441)));t=n.O(t)})();