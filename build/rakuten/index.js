(()=>{"use strict";var e,n={441:(e,n,o)=>{const r=window.wp.blocks,a=window.wp.i18n,t=window.wp.blockEditor,i=window.wp.components,l=window.wp.element,s=window.wp.apiFetch;var c=o.n(s);const d=window.ReactJSXRuntime,m=JSON.parse('{"UU":"create-block/rakuten"}');(0,r.registerBlockType)(m.UU,{edit:function({attributes:e,setAttributes:n}){const[o,r]=(0,l.useState)(null),[s,m]=(0,l.useState)(!1),[p,h]=(0,l.useState)(null),u=(0,l.useRef)(null),g=(0,l.useCallback)((async()=>{if(!e.id&&!e.no&&!e.kw)return r(null),void n((e=>({...e,imageUrl:""})));m(!0),h(null);try{const o=await c()({path:`/myplugin/v1/rakuten/?id=${encodeURIComponent(e.id||"")}&kw=${encodeURIComponent(e.kw||"")}&no=${encodeURIComponent(e.no||"")}`});if(o?.Items?.[0]?.Item){const e=o.Items[0].Item;r(e);const a=e.mediumImageUrls?.[0]?.imageUrl||"";n((e=>({...e,imageUrl:a}))),h(null)}else o?.error?(r(null),n((e=>({...e,imageUrl:""}))),h("APIエラー: "+(o.error_description||"リクエスト制限に達しました。しばらく待ってから再度お試しください。"))):(r(null),n((e=>({...e,imageUrl:""}))),h("データが取得できませんでした"))}catch(e){console.error("Rakuten API fetch error:",e),r(null),n((e=>({...e,imageUrl:""}))),h("APIエラーが発生しました。しばらく待ってから再度お試しください。")}finally{m(!1)}}),[e.id,e.no,e.kw,n]),k=(0,l.useCallback)((async()=>{if(window.confirm("本当にキャッシュを削除してもいいですか？"))try{await c()({path:"/myplugin/v1/rakuten-cache/",method:"POST",data:{id:e.id,kw:e.kw,no:e.no}}),g()}catch(e){console.error("Cache clear error:",e)}}),[e.id,e.kw,e.no,g]);(0,l.useEffect)((()=>(u.current&&clearTimeout(u.current),e.id||e.no||e.kw?u.current=setTimeout((()=>{g()}),1e3):r(null),()=>{u.current&&clearTimeout(u.current)})),[e.id,e.no,e.kw]);const[x,f]=(0,l.useState)(0),w=e.imageUrl||(o&&o.mediumImageUrls&&o.mediumImageUrls[0]?o.mediumImageUrls[0].imageUrl:"");(0,l.useEffect)((()=>{f((e=>e+1))}),[w]);const b=e.title||(o?o.itemName:""),j=o&&(o.affiliateUrl||o.itemUrl)||"#";return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(t.InspectorControls,{children:[(0,d.jsxs)(i.PanelBody,{title:(0,a.__)("商品情報設定","rakuten"),initialOpen:!0,children:[(0,d.jsx)(i.TextControl,{label:(0,a.__)("アイテムコード（ID）","rakuten"),help:e.no?(0,a.__)("商品番号が入力されている場合は入力できません","rakuten"):"",value:e.id,disabled:!!e.no,onChange:e=>{n({id:e,no:""})},style:e.no?{backgroundColor:"#f5f5f5",color:"#aaa"}:{}}),(0,d.jsx)(i.TextControl,{label:(0,a.__)("商品番号","rakuten"),help:e.id?(0,a.__)("アイテムコード（ID）が入力されている場合は入力できません","rakuten"):"",value:e.no,disabled:!!e.id,onChange:e=>{n({no:e,id:""})},style:e.id?{backgroundColor:"#f5f5f5",color:"#aaa"}:{}}),(0,d.jsx)(i.FormTokenField,{label:(0,a.__)("キーワード指定","rakuten"),value:e.kw?e.kw.split(",").filter(Boolean):[],onChange:e=>n({kw:e.join(",")}),placeholder:(0,a.__)("キーワードを入力してEnter","rakuten")}),(0,d.jsx)(i.TextControl,{label:(0,a.__)("ショップコード","rakuten"),value:e.shop,onChange:e=>n({shop:e})}),(0,d.jsx)(i.FormTokenField,{label:(0,a.__)("サーチ","rakuten"),value:e.search?e.search.split(",").filter(Boolean):[],onChange:e=>n({search:e.join(",")}),placeholder:(0,a.__)("サーチを入力してEnter","rakuten")}),(0,d.jsx)(i.TextareaControl,{label:(0,a.__)("タイトル","rakuten"),value:e.title,onChange:e=>n({title:e})}),(0,d.jsx)(i.ToggleControl,{label:(0,a.__)("価格表示","rakuten"),checked:e.price,onChange:e=>n({price:e})}),(0,d.jsx)(i.TextareaControl,{label:(0,a.__)("説明文","rakuten"),value:e.desc,onChange:e=>n({desc:e})}),(0,d.jsx)(i.__experimentalHeading,{children:"画像アップロード"}),(0,d.jsx)(t.MediaUploadCheck,{children:(0,d.jsxs)("div",{style:{marginBottom:"0"},children:[(""!==e.imageUrl?e.imageUrl:o?.mediumImageUrls?.[0]?.imageUrl)&&(0,d.jsx)("div",{style:{marginBottom:"10px",display:"flex",justifyContent:"center",backgroundColor:"#eee"},children:(0,d.jsx)("img",{src:""!==e.imageUrl?e.imageUrl:o?.mediumImageUrls?.[0]?.imageUrl,alt:"",style:{display:"block"}})}),(0,d.jsx)(t.MediaUpload,{onSelect:e=>n({imageUrl:e.url||""}),allowedTypes:["image"],render:({open:o})=>(0,d.jsxs)(i.Flex,{children:[(0,d.jsx)(i.Button,{onClick:o,variant:"secondary",children:"画像を選択"}),e.imageUrl&&(0,d.jsx)(i.Button,{style:{marginTop:4},onClick:()=>n({imageUrl:""}),isDestructive:!0,children:(0,a.__)("画像をリセット","rakuten")})]})})]})}),(0,d.jsx)("div",{style:{margin:"24px 0 0 0"}}),(0,d.jsx)(i.__experimentalHeading,{children:"ボタン表示設定"}),(0,d.jsx)(i.ToggleControl,{label:(0,a.__)("Amazonボタンを表示","rakuten"),checked:!1!==e.showAmazon,onChange:e=>n({showAmazon:e})}),(0,d.jsx)(i.ToggleControl,{label:(0,a.__)("楽天ボタンを表示","rakuten"),checked:!1!==e.showRakuten,onChange:e=>n({showRakuten:e})}),(0,d.jsx)(i.ToggleControl,{label:(0,a.__)("Yahoo!ボタンを表示","rakuten"),checked:!1!==e.showYahoo,onChange:e=>n({showYahoo:e})}),(0,d.jsx)(i.ToggleControl,{label:(0,a.__)("メルカリボタンを表示","rakuten"),checked:!1!==e.showMercari,onChange:e=>n({showMercari:e})}),(0,d.jsx)(i.ToggleControl,{label:(0,a.__)("DMMボタンを表示","rakuten"),checked:!1!==e.showDmm,onChange:e=>n({showDmm:e})})]}),(0,d.jsx)(i.PanelBody,{title:(0,a.__)("アフィリエイト設定","rakuten"),initialOpen:!1,children:(0,d.jsx)(i.Button,{href:`${window.location.origin}/wp-admin/admin.php?page=affiliate-settings`,target:"_blank",className:"",variant:"primary",icon:"admin-generic",style:{marginTop:"5px",width:"100%",textAlign:"center"},children:(0,a.__)("アフィリエイト設定","rakuten")})})]}),(0,d.jsx)("div",{...(0,t.useBlockProps)(),children:s?(0,d.jsx)("div",{style:{padding:"32px",textAlign:"center",color:"#888"},children:"Loading..."}):p?(0,d.jsx)("div",{style:{padding:"32px",textAlign:"center",color:"red"},children:p}):e.id||e.no||e.kw?(0,d.jsxs)("div",{className:"rakuten-item-box product-item-box no-icon pis-m",children:[(0,d.jsx)("figure",{className:"rakuten-item-thumb product-item-thumb",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:j,className:"rakuten-item-thumb-link product-item-thumb-link",target:"_blank",title:b,children:w&&(0,d.jsx)("img",{decoding:"async",src:w,alt:b||"商品画像",width:"128",height:"128",className:"rakuten-item-thumb-image product-item-thumb-image"},x)})}),(0,d.jsxs)("div",{className:"rakuten-item-content product-item-content cf",children:[(0,d.jsx)("div",{className:"rakuten-item-title product-item-title",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:j,className:"rakuten-item-title-link product-item-title-link",target:"_blank",title:b,children:b||""})}),(0,d.jsxs)("div",{className:"rakuten-item-snippet product-item-snippet",children:[(o?.shopName||e.shop)&&(0,d.jsx)("div",{className:"rakuten-item-maker product-item-maker",children:o?.shopName||e.shop}),e.price&&(0,d.jsxs)("div",{className:"product-item-price",children:[(0,d.jsx)("span",{className:"item-price",children:o?.itemPrice?`￥ ${o.itemPrice}`:"価格情報なし"}),(0,d.jsx)("span",{className:"acquired-date",children:o?.itemPrice?`（${(new Date).toLocaleDateString()} 時点）`:""})]}),e.desc&&(0,d.jsx)("div",{className:"product-item-description",children:e.desc})]}),(0,d.jsx)("div",{className:"amazon-item-buttons product-item-buttons",children:e.kw&&e.kw.split(",").filter(Boolean).length>0&&(()=>{const n=e.kw.split(",").map((e=>e.trim())).filter(Boolean).join(" "),o=window.MyAffiliateSettings||{},r=[];return o.amazon&&!1!==e.showAmazon&&r.push((0,d.jsx)("div",{className:"shoplinkamazon",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://www.amazon.co.jp/gp/search?keywords=${encodeURIComponent(n)}`,target:"_blank",style:{backgroundColor:"#f79901",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",marginRight:"6px",textDecoration:"none"},children:"Amazon"})},"amazon")),o.rakuten&&!1!==e.showRakuten&&r.push((0,d.jsx)("div",{className:"shoplinkrakuten",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://search.rakuten.co.jp/search/mall/${encodeURIComponent(n)}/`,target:"_blank",style:{backgroundColor:"#bf0000",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",marginRight:"6px",textDecoration:"none"},children:"楽天"})},"rakuten")),o.yahoo&&!1!==e.showYahoo&&r.push((0,d.jsx)("div",{className:"shoplinkyahoo",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://search.shopping.yahoo.co.jp/search?p=${encodeURIComponent(n)}`,target:"_blank",style:{backgroundColor:"#e60033",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",marginRight:"6px",textDecoration:"none"},children:"Yahoo!ショッピング"})},"yahoo")),o.mercari&&!1!==e.showMercari&&r.push((0,d.jsx)("div",{className:"shoplinkmercari",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://jp.mercari.com/search?keyword=${encodeURIComponent(n)}`,target:"_blank",style:{backgroundColor:"#4dc9ff",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",marginRight:"6px",textDecoration:"none"},children:"メルカリ"})},"mercari")),o.dmm&&!1!==e.showDmm&&r.push((0,d.jsx)("div",{className:"shoplinkdmm",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://www.dmm.com/search/=/searchstr=${encodeURIComponent(n)}/`,target:"_blank",style:{backgroundColor:"#00bcd4",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",marginRight:"6px",textDecoration:"none"},children:"DMM"})},"dmm")),r})()}),(0,d.jsxs)("div",{className:"product-item-admin",children:[(0,d.jsx)(i.Button,{variant:"link",onClick:k,style:{color:"#0073aa",textDecoration:"underline",cursor:"pointer",padding:0,marginRight:"10px"},children:"キャッシュ削除"}),(0,d.jsxs)("span",{className:"product-affiliate-rate",children:["料率：",o?.affiliateRate?`${o.affiliateRate}%`:""]})]})]})]}):(0,d.jsx)("div",{style:{padding:"32px",textAlign:"center",color:"#666",backgroundColor:"#f5f5f5",border:"1px dashed #ccc",borderRadius:"4px"},children:"商品情報を設定してください"})})]})}})}},o={};function r(e){var a=o[e];if(void 0!==a)return a.exports;var t=o[e]={exports:{}};return n[e](t,t.exports,r),t.exports}r.m=n,e=[],r.O=(n,o,a,t)=>{if(!o){var i=1/0;for(d=0;d<e.length;d++){for(var[o,a,t]=e[d],l=!0,s=0;s<o.length;s++)(!1&t||i>=t)&&Object.keys(r.O).every((e=>r.O[e](o[s])))?o.splice(s--,1):(l=!1,t<i&&(i=t));if(l){e.splice(d--,1);var c=a();void 0!==c&&(n=c)}}return n}t=t||0;for(var d=e.length;d>0&&e[d-1][2]>t;d--)e[d]=e[d-1];e[d]=[o,a,t]},r.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return r.d(n,{a:n}),n},r.d=(e,n)=>{for(var o in n)r.o(n,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},r.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),(()=>{var e={68:0,708:0};r.O.j=n=>0===e[n];var n=(n,o)=>{var a,t,[i,l,s]=o,c=0;if(i.some((n=>0!==e[n]))){for(a in l)r.o(l,a)&&(r.m[a]=l[a]);if(s)var d=s(r)}for(n&&n(o);c<i.length;c++)t=i[c],r.o(e,t)&&e[t]&&e[t][0](),e[t]=0;return r.O(d)},o=globalThis.webpackChunkproduct_link_maker=globalThis.webpackChunkproduct_link_maker||[];o.forEach(n.bind(null,0)),o.push=n.bind(null,o.push.bind(o))})();var a=r.O(void 0,[708],(()=>r(441)));a=r.O(a)})();