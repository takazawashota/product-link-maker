(()=>{"use strict";var e,o={441:(e,o,t)=>{const n=window.wp.blocks,r=window.wp.i18n,l=window.wp.blockEditor,a=window.wp.components,i=window.wp.element,s=window.wp.apiFetch;var c=t.n(s);const d=window.ReactJSXRuntime,u=JSON.parse('{"UU":"product-link-maker/rakuten"}');(0,n.registerBlockType)(u.UU,{edit:function({attributes:e,setAttributes:o}){const[t,n]=(0,i.useState)(null),[s,u]=(0,i.useState)(!1),[m,p]=(0,i.useState)(null),h=(0,i.useRef)(null),x=(0,i.useCallback)((async()=>{if(!e.id&&!e.no&&!e.kw)return n(null),void o((e=>({...e,imageUrl:""})));u(!0),p(null);try{const t=await c()({path:`/product-link-maker/v1/rakuten/?id=${encodeURIComponent(e.id||"")}&kw=${encodeURIComponent(e.kw||"")}&no=${encodeURIComponent(e.no||"")}`});if(t?.Items?.[0]?.Item){const e=t.Items[0].Item;n(e);const r=e.mediumImageUrls?.[0]?.imageUrl||"";o((e=>({...e,imageUrl:r}))),p(null)}else t?.error?(n(null),o((e=>({...e,imageUrl:""}))),p("APIエラー: "+(t.error_description||"リクエスト制限に達しました。しばらく待ってから再度お試しください。"))):(n(null),o((e=>({...e,imageUrl:""}))),p("データが取得できませんでした"))}catch(e){console.error("Rakuten API fetch error:",e),n(null),o((e=>({...e,imageUrl:""}))),p("APIエラーが発生しました。しばらく待ってから再度お試しください。")}finally{u(!1)}}),[e.id,e.no,e.kw,o]),k=(0,i.useCallback)((async()=>{if(window.confirm("本当にキャッシュを削除してもいいですか？"))try{await c()({path:"/product-link-maker/v1/rakuten-cache/",method:"POST",data:{id:e.id,kw:e.kw,no:e.no}}),x()}catch(e){console.error("Cache clear error:",e)}}),[e.id,e.kw,e.no,x]);(0,i.useEffect)((()=>(h.current&&clearTimeout(h.current),e.id||e.no||e.kw?h.current=setTimeout((()=>{x()}),1e3):n(null),()=>{h.current&&clearTimeout(h.current)})),[e.id,e.no,e.kw]);const[f,g]=(0,i.useState)(0),b=e.imageUrl||(t&&t.mediumImageUrls&&t.mediumImageUrls[0]?t.mediumImageUrls[0].imageUrl:"");(0,i.useEffect)((()=>{g((e=>e+1))}),[b]);const j=e.title||(t?t.itemName:""),w=t&&(t.affiliateUrl||t.itemUrl)||"#";return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(l.InspectorControls,{children:[(0,d.jsxs)(a.PanelBody,{title:(0,r.__)("商品情報設定","product-link-maker"),initialOpen:!0,children:[(0,d.jsx)(a.TextControl,{label:(0,r.__)("アイテムコード（ID）","product-link-maker"),help:e.no?(0,r.__)("商品番号が入力されている場合は入力できません","product-link-maker"):"",value:e.id,disabled:!!e.no,onChange:e=>{o({id:e,no:""})},placeholder:"book:11830886",style:e.no?{backgroundColor:"#f5f5f5",color:"#aaa"}:{}}),(0,d.jsx)(a.TextControl,{label:(0,r.__)("商品番号","product-link-maker"),help:e.id?(0,r.__)("アイテムコード（ID）が入力されている場合は入力できません","product-link-maker"):"",value:e.no,disabled:!!e.id,onChange:e=>{o({no:e,id:""})},placeholder:"4902102072625",style:e.id?{backgroundColor:"#f5f5f5",color:"#aaa"}:{}}),(0,d.jsx)(a.FormTokenField,{label:(0,r.__)("キーワード指定","product-link-maker"),value:e.kw?e.kw.split(",").filter(Boolean):[],onChange:e=>o({kw:e.join(",")}),placeholder:(0,r.__)("キーワードを入力してEnter","product-link-maker")}),(0,d.jsx)(a.TextControl,{label:(0,r.__)("ショップコード","product-link-maker"),value:e.shop,onChange:e=>o({shop:e})}),(0,d.jsx)(a.FormTokenField,{label:(0,r.__)("サーチ","product-link-maker"),value:e.search?e.search.split(",").filter(Boolean):[],onChange:e=>o({search:e.join(",")}),placeholder:(0,r.__)("サーチを入力してEnter","product-link-maker")}),(0,d.jsx)(a.TextareaControl,{label:(0,r.__)("タイトル","product-link-maker"),value:e.title,onChange:e=>o({title:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,r.__)("店名表示","product-link-maker"),checked:!1!==e.showShop,onChange:e=>o({showShop:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,r.__)("価格表示","product-link-maker"),checked:e.price,onChange:e=>o({price:e})}),(0,d.jsx)(a.TextareaControl,{label:(0,r.__)("説明文","product-link-maker"),value:e.desc,onChange:e=>o({desc:e})}),(0,d.jsx)(a.__experimentalHeading,{children:"画像アップロード"}),(0,d.jsx)(l.MediaUploadCheck,{children:(0,d.jsxs)("div",{style:{marginBottom:"0"},children:[(""!==e.imageUrl?e.imageUrl:t?.mediumImageUrls?.[0]?.imageUrl)&&(0,d.jsx)("div",{style:{marginBottom:"10px",display:"flex",justifyContent:"center",backgroundColor:"#eee"},children:(0,d.jsx)("img",{src:""!==e.imageUrl?e.imageUrl:t?.mediumImageUrls?.[0]?.imageUrl,alt:"",style:{display:"block"}})}),(0,d.jsx)(l.MediaUpload,{onSelect:e=>o({imageUrl:e.url||""}),allowedTypes:["image"],render:({open:t})=>(0,d.jsxs)(a.Flex,{children:[(0,d.jsx)(a.Button,{onClick:t,variant:"secondary",children:"画像を選択"}),e.imageUrl&&(0,d.jsx)(a.Button,{style:{marginTop:4},onClick:()=>o({imageUrl:""}),isDestructive:!0,children:(0,r.__)("画像をリセット","product-link-maker")})]})})]})}),(0,d.jsx)("div",{style:{margin:"24px 0 0 0"}}),(0,d.jsx)(a.__experimentalHeading,{children:"ボタン表示設定"}),(0,d.jsx)(a.ToggleControl,{label:(0,r.__)("Amazonボタンを表示","product-link-maker"),checked:!1!==e.showAmazon,onChange:e=>o({showAmazon:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,r.__)("楽天ボタンを表示","product-link-maker"),checked:!1!==e.showRakuten,onChange:e=>o({showRakuten:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,r.__)("Yahoo!ボタンを表示","product-link-maker"),checked:!1!==e.showYahoo,onChange:e=>o({showYahoo:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,r.__)("メルカリボタンを表示","product-link-maker"),checked:!1!==e.showMercari,onChange:e=>o({showMercari:e})}),(0,d.jsx)(a.ToggleControl,{label:(0,r.__)("DMMボタンを表示","product-link-maker"),checked:!1!==e.showDmm,onChange:e=>o({showDmm:e})})]}),(0,d.jsxs)(a.PanelBody,{title:(0,r.__)("カスタムボタン（前）","product-link-maker"),initialOpen:!0,children:[(0,d.jsx)("p",{style:{fontSize:"13px",color:"#757575",marginTop:0},children:"既存のボタンの前に表示されるカスタムボタンを追加できます"}),(e.customButtonsBefore||[]).map(((t,n)=>(0,d.jsxs)(a.Card,{style:{marginBottom:"16px",border:"1px solid #ddd"},children:[(0,d.jsx)(a.CardHeader,{children:(0,d.jsxs)(a.Flex,{justify:"space-between",align:"center",children:[(0,d.jsxs)("span",{style:{fontWeight:600},children:["ボタン ",n+1]}),(0,d.jsx)(a.Button,{isDestructive:!0,isSmall:!0,onClick:()=>{const t=[...e.customButtonsBefore||[]];t.splice(n,1),o({customButtonsBefore:t})},icon:"trash"})]})}),(0,d.jsxs)(a.CardBody,{children:[(0,d.jsx)(a.TextControl,{label:"ボタンテキスト",value:t.text||"",onChange:t=>{const r=[...e.customButtonsBefore||[]];r[n]={...r[n],text:t},o({customButtonsBefore:r})},placeholder:"例: 公式サイト"}),(0,d.jsx)(a.TextControl,{label:"リンクURL",value:t.url||"",onChange:t=>{const r=[...e.customButtonsBefore||[]];r[n]={...r[n],url:t},o({customButtonsBefore:r})},placeholder:"https://example.com"}),(0,d.jsx)(a.ToggleControl,{label:"別タブで開く",checked:!1!==t.openInNewTab,onChange:t=>{const r=[...e.customButtonsBefore||[]];r[n]={...r[n],openInNewTab:t},o({customButtonsBefore:r})}}),(0,d.jsxs)("div",{style:{marginTop:"12px"},children:[(0,d.jsxs)(a.Button,{variant:"secondary",onClick:()=>{const t=[...e.customButtonsBefore||[]];t[n]={...t[n],showColorPicker:!t[n].showColorPicker},o({customButtonsBefore:t})},style:{width:"100%",marginBottom:"8px"},children:[t.showColorPicker?"色を選択中":"ボタンの色を選択",(0,d.jsx)("span",{style:{marginLeft:"8px",width:"20px",height:"20px",backgroundColor:t.color||"#2196f3",display:"inline-block",borderRadius:"3px",border:"1px solid #ddd",verticalAlign:"middle"}})]}),t.showColorPicker&&(0,d.jsx)(a.ColorPicker,{color:t.color||"#2196f3",onChange:t=>{const r=[...e.customButtonsBefore||[]];r[n]={...r[n],color:t},o({customButtonsBefore:r})},enableAlpha:!0,defaultValue:"#2196f3"})]})]})]},n))),(0,d.jsx)(a.Button,{variant:"secondary",onClick:()=>{const t=[...e.customButtonsBefore||[],{text:"",url:"",openInNewTab:!0,color:"#2196f3"}];o({customButtonsBefore:t})},icon:"plus",style:{width:"100%",justifyContent:"center"},children:"ボタンを追加"})]}),(0,d.jsxs)(a.PanelBody,{title:(0,r.__)("カスタムボタン（後）","product-link-maker"),initialOpen:!0,children:[(0,d.jsx)("p",{style:{fontSize:"13px",color:"#757575",marginTop:0},children:"既存のボタンの後に表示されるカスタムボタンを追加できます"}),(e.customButtonsAfter||[]).map(((t,n)=>(0,d.jsxs)(a.Card,{style:{marginBottom:"16px",border:"1px solid #ddd"},children:[(0,d.jsx)(a.CardHeader,{children:(0,d.jsxs)(a.Flex,{justify:"space-between",align:"center",children:[(0,d.jsxs)("span",{style:{fontWeight:600},children:["ボタン ",n+1]}),(0,d.jsx)(a.Button,{isDestructive:!0,isSmall:!0,onClick:()=>{const t=[...e.customButtonsAfter||[]];t.splice(n,1),o({customButtonsAfter:t})},icon:"trash"})]})}),(0,d.jsxs)(a.CardBody,{children:[(0,d.jsx)(a.TextControl,{label:"ボタンテキスト",value:t.text||"",onChange:t=>{const r=[...e.customButtonsAfter||[]];r[n]={...r[n],text:t},o({customButtonsAfter:r})},placeholder:"例: 公式サイト"}),(0,d.jsx)(a.TextControl,{label:"リンクURL",value:t.url||"",onChange:t=>{const r=[...e.customButtonsAfter||[]];r[n]={...r[n],url:t},o({customButtonsAfter:r})},placeholder:"https://example.com"}),(0,d.jsx)(a.ToggleControl,{label:"別タブで開く",checked:!1!==t.openInNewTab,onChange:t=>{const r=[...e.customButtonsAfter||[]];r[n]={...r[n],openInNewTab:t},o({customButtonsAfter:r})}}),(0,d.jsxs)("div",{style:{marginTop:"12px"},children:[(0,d.jsxs)(a.Button,{variant:"secondary",onClick:()=>{const t=[...e.customButtonsAfter||[]];t[n]={...t[n],showColorPicker:!t[n].showColorPicker},o({customButtonsAfter:t})},style:{width:"100%",marginBottom:"8px"},children:[t.showColorPicker?"色を選択中":"ボタンの色を選択",(0,d.jsx)("span",{style:{marginLeft:"8px",width:"20px",height:"20px",backgroundColor:t.color||"#2196f3",display:"inline-block",borderRadius:"3px",border:"1px solid #ddd",verticalAlign:"middle"}})]}),t.showColorPicker&&(0,d.jsx)(a.ColorPicker,{color:t.color||"#2196f3",onChange:t=>{const r=[...e.customButtonsAfter||[]];r[n]={...r[n],color:t},o({customButtonsAfter:r})},enableAlpha:!0,defaultValue:"#2196f3"})]})]})]},n))),(0,d.jsx)(a.Button,{variant:"secondary",onClick:()=>{const t=[...e.customButtonsAfter||[],{text:"",url:"",openInNewTab:!0,color:"#2196f3"}];o({customButtonsAfter:t})},icon:"plus",style:{width:"100%",justifyContent:"center"},children:"ボタンを追加"})]}),(0,d.jsx)(a.PanelBody,{title:(0,r.__)("アフィリエイト設定","product-link-maker"),initialOpen:!1,children:(0,d.jsx)(a.Button,{href:`${window.location.origin}/wp-admin/options-general.php?page=product-link-maker`,target:"_blank",className:"",variant:"primary",icon:"admin-generic",style:{marginTop:"5px",width:"100%",textAlign:"center"},children:(0,r.__)("アフィリエイト設定","product-link-maker")})})]}),(0,d.jsx)("div",{...(0,l.useBlockProps)(),children:s?(0,d.jsx)("div",{style:{padding:"32px",textAlign:"center",color:"#888",backgroundColor:"#f5f5f5",border:"1px dashed #ccc",borderRadius:"4px"},children:"Loading..."}):m?(0,d.jsx)("div",{style:{padding:"32px",textAlign:"center",color:"#d63638",backgroundColor:"#fff0f0",border:"1px solid #d63638",borderRadius:"4px"},children:m}):e.id||e.no||e.kw?(0,d.jsxs)("div",{className:"rakuten-item-box product-item-box no-icon pis-m",children:[(0,d.jsx)("figure",{className:"rakuten-item-thumb product-item-thumb",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:w,className:"rakuten-item-thumb-link product-item-thumb-link",target:"_blank",title:j,children:b&&(0,d.jsx)("img",{decoding:"async",src:b,alt:j||"商品画像",width:"128",height:"128",className:"rakuten-item-thumb-image product-item-thumb-image"},f)})}),(0,d.jsxs)("div",{className:"rakuten-item-content product-item-content cf",children:[(0,d.jsx)("div",{className:"rakuten-item-title product-item-title",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:w,className:"rakuten-item-title-link product-item-title-link",target:"_blank",title:j,children:j||""})}),(0,d.jsxs)("div",{className:"rakuten-item-snippet product-item-snippet",children:[!1!==e.showShop&&(t?.shopName||e.shop)&&(0,d.jsx)("div",{className:"rakuten-item-maker product-item-maker",children:t?.shopName||e.shop}),e.price&&(0,d.jsxs)("div",{className:"product-item-price",children:[(0,d.jsx)("span",{className:"item-price",children:t?.itemPrice?`￥ ${t.itemPrice}`:"価格情報なし"}),(0,d.jsx)("span",{className:"acquired-date",children:t?.itemPrice?`（${(new Date).toLocaleDateString()} 時点）`:""})]}),e.desc&&(0,d.jsx)("div",{className:"product-item-description",children:e.desc})]}),(0,d.jsx)("div",{className:"amazon-item-buttons product-item-buttons",children:e.kw&&e.kw.split(",").filter(Boolean).length>0&&(()=>{const o=e.kw.split(",").map((e=>e.trim())).filter(Boolean).join(" "),t=window.ProductLinkMakerSettings||{},n=[];if((e.customButtonsBefore||[]).forEach(((e,o)=>{e.text&&e.url&&n.push((0,d.jsx)("div",{className:"shoplink-custom",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:e.url,target:!1!==e.openInNewTab?"_blank":"_self",style:{backgroundColor:e.color||"#2196f3",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",textDecoration:"none"},children:e.text})},`custom-before-${o}`))})),t.amazon&&!1!==e.showAmazon&&n.push((0,d.jsx)("div",{className:"shoplinkamazon",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://www.amazon.co.jp/gp/search?keywords=${encodeURIComponent(o)}`,target:"_blank",style:{backgroundColor:"#f79901",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",textDecoration:"none"},children:"Amazon"})},"amazon")),t.rakuten&&!1!==e.showRakuten&&n.push((0,d.jsx)("div",{className:"shoplinkrakuten",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://search.rakuten.co.jp/search/mall/${encodeURIComponent(o)}/`,target:"_blank",style:{backgroundColor:"#bf0000",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",textDecoration:"none"},children:"楽天"})},"rakuten")),t.yahoo&&!1!==e.showYahoo&&n.push((0,d.jsx)("div",{className:"shoplinkyahoo",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://search.shopping.yahoo.co.jp/search?p=${encodeURIComponent(o)}`,target:"_blank",style:{backgroundColor:"#e60033",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",textDecoration:"none"},children:"Yahoo!ショッピング"})},"yahoo")),t.mercari&&!1!==e.showMercari&&n.push((0,d.jsx)("div",{className:"shoplinkmercari",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:`https://jp.mercari.com/search?keyword=${encodeURIComponent(o)}`,target:"_blank",style:{backgroundColor:"#4dc9ff",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",textDecoration:"none"},children:"メルカリ"})},"mercari")),t.dmm&&!1!==e.showDmm){const e=`https://www.dmm.com/search/=/searchstr=${encodeURIComponent(o)}/analyze=V1ECCVYAUQQ_/limit=30/sort=rankprofile/?utm_medium=dmm_affiliate&utm_source=dummy&utm_term=dmm.com&utm_campaign=affiliate_link_tool&utm_content=link`;n.push((0,d.jsx)("div",{className:"shoplinkdmm",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:e,target:"_blank",style:{backgroundColor:"#00bcd4",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",textDecoration:"none"},children:"DMM"})},"dmm"))}return(e.customButtonsAfter||[]).forEach(((e,o)=>{e.text&&e.url&&n.push((0,d.jsx)("div",{className:"shoplink-custom",children:(0,d.jsx)("a",{rel:"nofollow noopener",href:e.url,target:!1!==e.openInNewTab?"_blank":"_self",style:{backgroundColor:e.color||"#2196f3",color:"#fff",borderRadius:"4px",padding:"6px 16px",display:"inline-block",textDecoration:"none"},children:e.text})},`custom-after-${o}`))})),n})()}),(0,d.jsxs)("div",{className:"product-item-admin",children:[(0,d.jsx)(a.Button,{variant:"link",onClick:k,style:{color:"#0073aa",textDecoration:"underline",cursor:"pointer",padding:0,marginRight:"10px"},children:"キャッシュ削除"}),(0,d.jsxs)("span",{className:"product-affiliate-rate",children:["料率：",t?.affiliateRate?`${t.affiliateRate}%`:""]})]})]})]}):(0,d.jsx)("div",{style:{padding:"32px",textAlign:"center",color:"#666",backgroundColor:"#f5f5f5",border:"1px dashed #ccc",borderRadius:"4px"},children:"商品情報を設定してください"})})]})}})}},t={};function n(e){var r=t[e];if(void 0!==r)return r.exports;var l=t[e]={exports:{}};return o[e](l,l.exports,n),l.exports}n.m=o,e=[],n.O=(o,t,r,l)=>{if(!t){var a=1/0;for(d=0;d<e.length;d++){for(var[t,r,l]=e[d],i=!0,s=0;s<t.length;s++)(!1&l||a>=l)&&Object.keys(n.O).every((e=>n.O[e](t[s])))?t.splice(s--,1):(i=!1,l<a&&(a=l));if(i){e.splice(d--,1);var c=r();void 0!==c&&(o=c)}}return o}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[t,r,l]},n.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return n.d(o,{a:o}),o},n.d=(e,o)=>{for(var t in o)n.o(o,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},n.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),(()=>{var e={68:0,708:0};n.O.j=o=>0===e[o];var o=(o,t)=>{var r,l,[a,i,s]=t,c=0;if(a.some((o=>0!==e[o]))){for(r in i)n.o(i,r)&&(n.m[r]=i[r]);if(s)var d=s(n)}for(o&&o(t);c<a.length;c++)l=a[c],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(d)},t=globalThis.webpackChunkproduct_link_maker=globalThis.webpackChunkproduct_link_maker||[];t.forEach(o.bind(null,0)),t.push=o.bind(null,t.push.bind(t))})();var r=n.O(void 0,[708],(()=>n(441)));r=n.O(r)})();